#!/opt/local/bin/ruby

require File.dirname(__FILE__) + '/../lib/nanite'
require File.dirname(__FILE__) + '/../lib/nanite/agent'

name, pass, *resources = ARGV
Nanite.identity  = name
Nanite.default_resources = resources.map{|r| Nanite::Resource.new(r)}
ARGV.clear
EM.run do
  AMQP.start :user     => Nanite.identity,
             :pass => pass,
             :vhost    => '/nanite'
  Nanite.run_event_loop false
end  